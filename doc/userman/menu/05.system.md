# Система

В этом разделе расположены служебные функции по обслуживанию устройства.


## Выключить вручную

`Длинным нажатием` на `среднюю кнопку` выключает питание устройства.

На деле же, устройство не отключается от источника питания (аккумулятора). Центральный процессор переходит в `режим глубокого сна`, дисплей переходит в режим энергосбережения, микроконтроллер NAVI отключается от питания полностью, а барометр остаётся подключенным к источнику питания - его энергопотребление минимально.

Работа центрального процессора ограничивается слежением за нажатием на кнопки, чтобы включить устройство обратно.

Обратно устройство включается `Длинным нажатием` на `среднюю кнопку`.


## Перезагрузить

`Длинным нажатием` на `среднюю кнопку` перезагружает устройство.

Функция нужна только при нештатной работе устройства.


## Сброс всех настроек

`Длинным нажатием` на `среднюю кнопку` сбрасывает все настройки устройства, в т.ч. отвязывает от Web-аккаунта.


## Обновление прошивки

Сам процесс обновления прошивки будет происходить во время синхронизации. В этом разделе можно выбрать версию прошивки, на которую обновляться.

Пункты меню:

* Текущая версия прошивки.
* Тип текущей прошивки.
* Аппаратная версия.
* Выбор прошивки, на которую обновляться.
* Обновление с SD-карты.

Типы прошивки:

* prod - обычная пользовательская прошивка
* debug - как и обычная, но включен режим отладки, в консоль отправляется служебная информация
* dev - прошивка разработчика, при синхронизации используется другой сервер, специально для отладки при разработке

Для каждой версии прошивки можно выбрать язык сообщений на дисплее: `русский` и `английский`.

Обновление прошивки при синхронизации будет происходить только если выбрана версия прошивки в пункте `Выбор прошивки`.

Обновление с SD карты доступно для аппаратной `[v.0.5]` и ПО `v0.6.3`. В этом подразделе нужно выбрать файл прошивки.
При наличии звёздочки (*) перед именем говорит о наличии MD5-файла, который поможет проверить целостность файла прошивки.
Отсутствие этого файла принципиально ни на что не влияет.


## Файлы

Все настройки устройства, логбук и записанные треки хранятся в виде файлов на внутренней `flash-памяти`.

В данном разделе можно посмотреть, какие файлы есть во внутренней памяти, и управлять ими:

* удаление файла - `длинным нажатием` на `среднюю кнопку`
* перенумерование логбук-файлов
* перенумерование треков

Треки и логбук хранятся в файлах, которые нумеруются по порядку. Если какой-то из этих файлов будет удалён, необходимо перенумеровать весь список. Иначе логбук или треки будут некорректно работать.


## Нав: serial

Включение режима NAV-serial позволяет управлять микропроцессором NAV-приёмника через серийный порт устройства.


## Нав: спутники

Список всех спутников, сигнал от которых видит NAV-приёмник.

    [02 GPS ] q-1   (17/60)
    [1d GPS ] q-7   (74/95)    30 dB
    [ff GLON] q-7   (74/95)    20 db

* В квадратных скобках указан идентификатор спутника - числовой svId и тип.

* `q-N` - качество сигнала, где N:

    * 0 - нет сигнала
    * 1 - поиск сигнала
    * 2 - сигнал получен
    * 3 - сигнал определён, но его нельзя использовать
    * 4 - код заблокирован, часы синхронизированы
    * 5-7 - код и сигнал заблокированы, часы синхронизированы

* Если после `q-N` отображается `*`, значит этот спутник используется для навигации

* В круглых скобках: возвышение (-90..+90) и азимут (0..360)

* Справа - отношение сигнал/шум


## Нав: Холодный перезапуск

Выполняет холодный перезапуск NAV-приёмника, при котором будет сброшен список спутников.


## Тестирование аппаратуры

Этот раздел позволяет проверить протестировать корректность работы узлов устройства.

* Часы - Даже если не синхронизированы, время должно идти, а не стоять на месте.
* Напряжение на батарее - Показывет текущее рассчитанное напряжение, должно быть в пределах `3.0-4.2 Вольт`.
* Заряжается ли батарея - При подключении USB-зарядки должно отображать `Да`.
* Показания барометра - Текущее атмосферное давление, должно быть в пределах `9-11 кПа`.
* Подсветка экрана - Включает подсветку по длинному нажатию на `среднюю кнопку` и через секунду подсветка отключается.
* Компас - Если включен опционально и поддерживается аппаратно.
* Данные с NAV-приёмника - Показывает задержку в приёме данных, она не должна превышать `500 мс`.
* Перезапуск по питанию микропроцессора NAV-приёмника -  По `длинному нажатию` на `среднюю кнопку`.
* Повторная инициализация NAV-приёмника - требуется, если NAV-приёмник был перезапущен пунктом выше.


## Калибровка магнетометра

Ручная калибровка компаса.

Подробно эта процедура описана в 
разделе [Навигация](05.navigation.md#Калибровка-компаса)


