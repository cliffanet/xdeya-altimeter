# Высотомер

Как и во всех других высотомерах, для определения текущей высоты применяется датчик давления.


***
## Датчик

Используемый датчик давления: BMP280.

Этот датчик хорошо зарекомендовал себя во многих проектах многочисленных разработчиков высотомеров и пищалок.

У него очень низкое энергопотребление, высокая скорость ответа, миниатюрные размеры, простота монтажа.

На плате датчик выглядит так:

<img src="bmp280-onboard.png" width="500" alt="Датчик давления на плате" align="center" />


***
## Калибровка высоты по текущему давлению

Устройство самостоятельно подстраивает давление нулевой высоты, пока Вы находитесь на земле.

Автоматическую подстройку можно отключить через `меню настроек`. Однако, в этом случае в течение дня определение высоты может уходить на 10, 20 или даже 50 метров в ту или другую сторону.

Если вы поднимитесь на высоту `40 м` и более, автоматическая подстройка будет отключена до момента, пока вы не вернётесь обратно на нулевой уровень.

В случае, если после приземления высотомер будет показывать более 40 метров и из-за этого не будет корректироваться, Вы можете сами вручную сбросить `уровень земли` через `меню настроек`.


***
## Сложности вычисления высоты по барометру

Основной проблемой для любых приборов, измеряющих высоту по барометру, являются зоны турбулентности и зоны повышенного давления. Особенно заметно это проявляется на скоростях `более 20 м/с` в любом направлении.

**Зоны турбулентности** встречаются достаточно часто:

* В летательном аппарате - это обычно зона у открытой двери.
* В свободном падении существенно турбулентный поток возникает над рукой, на которой закреплён высотомер.

**Зона повышенного давления** формируется в двух случаях:
* если измеряющее давление устройство находится под телом в непосредственной близости от него в свободном падении;
* в салоне самолёта, если размеры двери небольшие по сравнению с объёмом салона.

Например, в инструкциях ко многим страхующим приборам в явном виде это описано. И указывается, что в положении на животе (когда прибор находится в зоне пониженного давления на спине) прибор сработает на `80 метров` ниже, чем в положении на спине (когда прибор находится в зоне повышенного давления).

В некоторых случаях погрешность показаний может достигать `более ±100 метров`. Помните об этом при учёте показаний с подобных приборов, в т.ч. и этого.

Вот пример замера высоты в момент отделения с ЛА с боковой дверью (время в мс и высота, частота замеров - 10 раз в секунду):

    3294		3991
    3396		3989
    3494		3993
    3596		3989
    3694		3987
    3796		3994
    3894		4010
    3996		4002    <---- Примерно тут высотник оказался за обрезом двери
    4093	    4025
    4197		4009
    4293		4044
    4395		4056
    4493		4064
    4595		4063
    4692		4072
    4794		4035
    4892		4071
    4994		4085
    5092		4107
    5196		4100
    5292		4087
    5394		4075
    5492		4065
    5594		4044
    5691		4027
    5793		4013
    5890		4006
    5992		4011
    6090		4023
    6194		4009
    6290		4014
    6392		4010
    6489		3996
    6591		4022
    6688		4015
    6790		4019
    6888		4000
    6990		4009
    7087		4050
    7191		4050
    7287		4048
    7389		4039
    7486		4021

Далее показания высоты уменьшались более последовательно.

Приведён пример отделения горизонтальной 8-way в захватах из самолёта Л-410. Устройство было на руке участника, отделяющегося из салона. А отделение мы завалили :smile:. Если устройство повесить на руку, отделяющегося снаружи, там всё ещё веселее.

Всё это создаёт значительные трудности в определении момента отделения. У высотомеров более известных брендов трудности те же самые, именно поэтому не стоит сильно доверять показаниям в вашем логбуке.

***
## Алгоритм определения фаз прыжка

В отличие от более простых высотомеров, где не так критична точность определения начала прыжка, в этом устройстве при начале прыжка требуется засечь текущие координаты и включить запись трека. Если точность определения прыжка будет низкой, полезность данного устройства будет сомнительной.

1. Каждый прыжок должен начинаться с подъёма. Эта фаза включается, когда примерно 5 секунд продолжается набор высоты. Без этой фазы все остальные невозможны.

2. Снижение может возникать по многим причинам:
    - удержание полёта на одном эшелоне,
    - временное снижение ЛА,
    - снижение некоторых ЛА при сбросе газа `на боевом`,
    - резкие изменения давления.
    
    Поэтому, для однозначного определения, что это именно отделение, скорость снижения дожна быть не менее 15 м/с на протяжении 5 секунд. В этом случае принимается решение, что это всё-таки отделение и падение.
    
    Момент отделения считается тот, что был 5 сек назад на момент принятия решения. Опыты показали, что это максимально близко к правде, если отделяться изнутри салона. Если сначала вывешиваться за бортом, то ошибка определения момента отделения достигает 2 сек.

3. Теперь надо решить, открыли ли мы парашют под бортом или падаем в свободном падении. Если за последующие 3 секунды скорость снижения достигнет 35 м/с, считается, что прыжок начался со свободного падения. Иначе, в логбук будет записано нулевое время свободного падения.

4. Если у нас всё-таки случилась фаза свободного падения, то она завершится, если около 6 секунд скорость снижения будет ниже 12 м/с. Моментом открытия будет тот, что был 6 секунд назад перед принятием решения.

5. Момент приземления - если высота ниже 50 метров сохраняется более 6 секунд.

Для того, чтобы в логбук писать верные значения, т.к. определение моментов начала каждой фазы происходит с опозданием в несколько секунд, ведётся непрерывный лог параметров на протяжении прошедших 10 секунд. И после принятия решения для каждой фазы нетрудно получить параметры начала фазы.
